<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>VR Video Player</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
      #uploader {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 999;
        background: rgba(0, 0, 0, 0.8);
        padding: 10px 20px;
        border-radius: 8px;
        color: white;
      }
    </style>
  </head>
  <body>
    <div id="uploader">
      <label for="videoFile">Upload video:</label>
      <input type="file" id="videoFile" accept="video/*" />
    </div>

    <a-scene vr-mode-ui="enabled: true">
      <!-- Sky background -->
      <a-sky color="#222"></a-sky>

      <!-- Video screen -->
      <a-video
        id="videoScreen"
        width="16"
        height="9"
        position="0 2 -6"
        rotation="0 0 0"
        src=""
      ></a-video>

      <!-- Camera and cursor for VR interaction -->
      <a-entity camera look-controls wasd-controls>
        <a-entity
          cursor="fuse: true; fuseTimeout: 500"
          position="0 0 -1"
          geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
          material="color: white; shader: flat"
        ></a-entity>
      </a-entity>
    </a-scene>

    <script>
      const fileInput = document.getElementById('videoFile');
      const videoElement = document.createElement('video');
      const aVideo = document.querySelector('#videoScreen');

      videoElement.setAttribute('crossorigin', 'anonymous');
      videoElement.setAttribute('webkit-playsinline', '');
      videoElement.setAttribute('playsinline', '');
      videoElement.setAttribute('loop', true);
      videoElement.setAttribute('controls', true);

      fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
          const videoURL = URL.createObjectURL(file);
          videoElement.src = videoURL;
          videoElement.load();
          videoElement.play();

          aVideo.setAttribute('src', `#${file.name}`);
          aVideo.setAttribute('material', 'shader: flat');

          // Attach video to the scene dynamically
          const assetItemId = file.name;
          let assets = document.querySelector('a-assets');
          if (!assets) {
            assets = document.createElement('a-assets');
            document.querySelector('a-scene').appendChild(assets);
          }

          const assetItem = document.createElement('video');
          assetItem.setAttribute('id', assetItemId);
          assetItem.setAttribute('src', videoURL);
          assetItem.setAttribute('autoplay', true);
          assetItem.setAttribute('loop', true);
          assetItem.setAttribute('crossorigin', 'anonymous');
          assetItem.setAttribute('playsinline', '');
          assetItem.setAttribute('webkit-playsinline', '');

          assets.appendChild(assetItem);
        }
      });
    </script>
  </body>
</html>
